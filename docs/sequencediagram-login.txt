title login request

participant Browser as br
participant "nodejs\nServer" as node
participant "users\ncontroller" as uc
participant "session\ncontroller" as sc
participant "api\ncontroller" as ac
participant  "account\nmanager" as am
participant  "user model\non MongoDB" as um
participant  "token model\non MongoDB" as tm
participant "Sling server" as sling


note over br,sling: login

br->node: email, password\npost to /api/session
activate br
activate node
node->sc: email, password\npost(session.login)
deactivate node
activate sc
sc->am:email, password\nto authenticate
deactivate sc
activate am
am->um:email, password
activate um
um-->am:user info
deactivate um
am->am:create token\nwith expire-time
am->sling:sling.id from user info\nrequest token
activate sling
sling-->am:sling.token
deactivate sling
am->tm:prime-token,expire-time,sling.token\nsave
activate tm
tm-->am:done
deactivate tm
am-->uc:user info with prime-token
deactivate am
uc-->node:user info\nprime-token
deactivate uc
node-->br:user info\nprime-token
deactivate node
deactivate br
