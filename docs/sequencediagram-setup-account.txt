title setup request

participant Browser as br
participant "nodejs\nServer" as node
participant "users\ncontroller" as uc
participant "session\ncontroller" as sc
participant "api\ncontroller" as ac
participant  "account\nmanager" as am
participant  "user model\non MongoDB" as um
participant  "token model\non MongoDB" as tm
participant "Sling server" as sling

note over br,sling: setup
br->node: email, password\npost to /api/users
activate br
activate node
node->uc: email, password\npost(users.create)
deactivate node
activate uc
uc->am:email, password\nto createAccount
activate am
am->sling:email
activate sling
sling-->am:sling.id
deactivate sling
am->um:email, password\nsling.id
activate um
um-->am:user info
deactivate um
am-->uc: user info
deactivate am
uc->am:user info
activate am
am->am:create token\nwith expire-time
am->sling:sling.id from user info\nrequest token
activate sling
sling-->am:sling.token
deactivate sling
am->tm:prime-token,expire-time,sling.token\nsave
activate tm
tm-->am:done
deactivate tm
am-->uc:user info with prime-token
deactivate am
uc-->node:user info\nprime-token
deactivate uc
node-->br:user info\nprime-token
deactivate node
deactivate br