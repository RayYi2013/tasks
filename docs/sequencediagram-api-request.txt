title api request

participant Browser as br
participant "nodejs\nServer" as node
participant "authenticate\nmiddleware" as auth
participant "users\ncontroller" as uc
participant "session\ncontroller" as sc
participant "api\ncontroller" as api
participant  "account\nmanager" as am
participant  "user model\non MongoDB" as um
participant  "token model\non MongoDB" as tm
participant "Sling server" as sling


note over br, sling: api request
br->node:request\nwith cookie
activate br
activate node
node->auth:token \nin header
activate auth
auth->am:token\nto validate
activate am
am->am:decode token
am->am:verify expire-time
am->tm:prime-token
activate tm
tm-->am:token info
deactivate tm
am->sling:sling.token\nto verify
activate sling
sling-->am:done
deactivate sling
am-->auth:done
deactivate am
auth->node:done
deactivate auth
node->api:request
activate api
api->api:create request\nwith sling.token
api->sling:request
activate sling
sling->api:response
deactivate sling
api-->node:response
deactivate api
node-->br:response
deactivate br
deactivate node

